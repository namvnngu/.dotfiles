#!/usr/bin/env bash

if [[ $* == *-h* ]]; then
  # Display Help
  echo "Fix and format git files based on the eslint config."
  echo
  echo "Syntax: ef [-s|-h]"
  echo "Options:"
  echo "      -s     Only git staged files"
  echo "      -t     Only git tracked files"
  echo "      -h     Print this help and exit"
  echo

  exit 0
fi

if [[ $* == *-s* ]]; then
  files=$(git diff --name-only --diff-filter=d --cached HEAD)
elif [[ $* == *-t* ]]; then
  files=$(git diff --name-only --diff-filter=d HEAD)
else
  tracked_files=$(git diff --name-only --diff-filter=d HEAD)
  untracked_files=$(git ls-files . --exclude-standard --others)
  files=$(echo "${tracked_files} ${untracked_files}" | tr " " "\n")
fi

filtered_files=$(echo "$files" | grep -E "((ts|js)x?)$")

if [[ -n $filtered_files ]]; then
  eslint_d --fix $filtered_files

  if [ $? -eq 0 ]; then
    echo "List of files formatted":
    filtered_files_array=($filtered_files)
    for file in "${filtered_files_array[@]}"
    do
      :
      echo "  âœ… $file"
    done
  fi
else
  echo "There are no changed files to be formatted"
fi
