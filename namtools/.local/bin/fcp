#!/usr/bin/env bash

# Author: Nam Nguyen <nguyenvietnam2401@gmail.com>
# Description: Find and copy something
# License: MIT License
# Date created: July 22, 2024
# Date modified: December 01, 2025

fcp_dir="${NAMTOOLS_DATA_DIR}"

if [[ $1 == "ls" ]]; then
  find "$fcp_dir" -maxdepth 1 -name "fcp-*.txt" \
    | sed -e "s/^.*fcp-//" -e "s/.txt$//"
  exit 0
fi

category="$1"
fcp_file="$fcp_dir/fcp-$category.txt"

# Fuzzy search

if [[ $# -eq 0 ]]; then
  files=$(find "$fcp_dir" -maxdepth 1 -name "fcp-*.txt" -exec cat {} '+')
  selected=$(echo "$files" | fzf)
elif [[ -e "$fcp_file" ]]; then
  selected=$(fzf < "$fcp_file")
else
  echo "$fcp_file: No such file"
  exit 1
fi

if [[ -z "$selected" ]]; then
  exit 1
fi

selected=${selected/%: */}

# Copy

os=$(uname -s)
case "$os" in
  Darwin*)
    echo -n "$selected" | pbcopy
    ;;
  Linux*)
    echo -n "$selected" | xclip -selection clipboard
    ;;
esac
echo "Copied to clipboard: $selected"
